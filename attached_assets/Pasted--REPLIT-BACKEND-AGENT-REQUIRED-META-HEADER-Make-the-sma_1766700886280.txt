[REPLIT BACKEND AGENT — REQUIRED META-HEADER]
- Make the smallest possible, localized changes only. Do NOT refactor unrelated code.
- Do NOT change DB schema, Prisma models, migrations, or any existing business flows (loads/stops/statuses). No new tables.
- Do NOT touch Resend/email logic at all.
- Keep all existing endpoints and response shapes backward-compatible.
- Your work is ONLY: (1) fix iOS Safari geolocation request flow on Driver page, (2) add explicit client+server debug logs for geolocation + ping storing.

GOAL
Fix the Driver tracking page so iOS Safari reliably requests location permission and, once granted, begins sending GPS pings automatically. Add clear client/server logs so we can prove where it fails.

SCOPE (ONLY THIS)
1) iOS Safari geolocation reliability:
   - Stop getting stuck on “Requesting location access…”
   - If permission is denied or previously blocked, show a clear hint + a “Try Again / Enable Location” button that triggers the location request from a user gesture (tap), which is critical on iOS.
   - Add timeouts and proper error handling.
2) Debug logs:
   - Client logs: request start, success, error/timeout, ping send success/failure.
   - Server logs: ping received (token/driver/load + lat/lng), stored, rejected, and why.

PROJECT CONTEXT (from screenshots)
- Frontend file likely: client/src/pages/driver-dashboard.tsx
- Backend file likely: server/routes.ts (Express)
- There is an existing tracking ping endpoint that stores driver location (name may vary).
- Public tracking page keeps polling /api/track/... and currently returns lastLocation:null → meaning ping is not being stored.

TASK A — CLIENT: Fix driver geolocation + add logs
1) Open: client/src/pages/driver-dashboard.tsx
2) Find existing geolocation logic and the “Requesting location access…” UI state.
3) Implement a small, robust geolocation helper inside this page (no big refactor, no new abstractions across app):
   - State machine example (keep minimal): 
     locationStatus: 'idle' | 'requesting' | 'granted' | 'denied' | 'error'
     locationError?: string
   - On page load:
     a) Set status -> 'requesting'
     b) Call navigator.geolocation.getCurrentPosition(success, error, options) with:
        { enableHighAccuracy: true, timeout: 12000, maximumAge: 0 }
     c) On success:
        - console.log("[Driver] geolocation success", { lat, lng, accuracy, ts })
        - set status -> 'granted'
        - immediately send first ping (do not wait 60s)
        - start an interval to send ping every 60 seconds (or use existing interval throttle if already present)
     d) On error:
        - console.log("[Driver] geolocation error", { code, message })
        - If code === 1 (PERMISSION_DENIED): status -> 'denied'
        - Else: status -> 'error' with message
     e) IMPORTANT iOS UX:
        - When status is 'denied' or 'error', render:
          - A short message explaining location is required
          - iOS Safari hint: Settings → Privacy & Security → Location Services → Safari Websites → Allow (While Using), and in Safari: aA → Website Settings → Location → Allow
          - A visible button: “Enable Location” / “Try Again”
          - On button click (user gesture), call the same request function again.
   - OPTIONAL (but helpful and still minimal):
     - After permission is granted, start watchPosition as well (with same options) to update faster, but still throttle pings to 60s. If you add watchPosition, ensure you clear it on unmount.
     - If watchPosition exists already, ensure it updates state and doesn’t silently fail.

4) Ping sending:
   - Find the existing ping call (fetch/axios) used by the driver page.
   - Ensure it is called:
     - Immediately after first geolocation success
     - Then every 60s
   - Add logs:
     - Before sending: console.log("[Driver] ping sending", { lat, lng, ts })
     - On success: console.log("[Driver] ping sent OK", { status })
     - On failure: console.log("[Driver] ping failed", { statusOrError })

5) Fix the “Requesting location access…” spinner logic:
   - It must not spin forever.
   - After 12s timeout -> move to 'error' and show “Try Again”.

Acceptance criteria (client):
- On iPhone Safari opening the driver link:
  - If permission not granted yet → iOS permission prompt appears.
  - If permission was denied before → page shows the hint + “Enable Location” button (not infinite spinner).
  - After allow → within a few seconds, console shows “[Driver] geolocation success …”
  - Then “[Driver] ping sending …” and “[Driver] ping sent OK …” (or a clear failure log).

TASK B — SERVER: Add debug logs to ping endpoint (no logic change unless needed for visibility)
1) Open: server/routes.ts
2) Locate the existing endpoint that receives driver GPS pings. It may be named like:
   - POST /api/track/ping
   - POST /api/tracking/ping
   - POST /api/driver/ping
   - etc.
3) Add logs (keep minimal, do not print secrets):
   - On request start:
     console.log("[TrackingPing] received", { hasToken: !!token, driverId, loadId, lat, lng, ua: req.headers['user-agent'] })
   - On validation failure:
     console.log("[TrackingPing] rejected", { reason, driverId, loadId })
   - On successful store:
     console.log("[TrackingPing] stored", { driverId, loadId, lat, lng })
4) If the endpoint currently returns success even when lat/lng are missing, add a clear reject log and return 400 (ONLY if it doesn’t break the app; otherwise keep response but log the issue). Prefer: keep response shape compatible.

Acceptance criteria (server):
- When the driver page sends pings, Replit console shows:
  - “[TrackingPing] received … lat/lng …”
  - then “[TrackingPing] stored …”
- If pings are not arriving, we should still see client logs indicating why.

TASK C — Quick manual test steps (write them in a short comment at end of your work, not as a new doc)
1) Open driver link on iPhone Safari.
2) Allow location.
3) Confirm:
   - iPhone Safari shows permission prompt OR the hint + “Enable Location” button.
   - Replit console shows TrackingPing received/stored every ~60s.
4) Open public tracking link:
   - lastLocation should no longer be null after first stored ping.

DELIVERABLE
- Commit only the minimal changes to:
  - client/src/pages/driver-dashboard.tsx
  - server/routes.ts
- No other files unless absolutely necessary for wiring the logs or fixing the geolocation state.