You are working on the PingPoint full-stack app (Prisma + PostgreSQL already wired, broker console and loads are working). We now want to improve multi-broker behavior, load details, system menu pages, billing stubs, and complete the magic-link verification flow.

IMPORTANT CONSTRAINTS
- Keep the existing Arcade 90s / WarCat UI.
- Make minimal changes to existing files; extend rather than refactor.
- Assume a Broker session is stored in a cookie (e.g. `pingpoint_broker_session`) containing a `brokerId`.

============================================================
1) MULTI-BROKER WORKFLOW & SWITCH / LOGOUT
============================================================

Goal:
- In one browser session there is still only ONE active broker at a time (this is fine).
- But the broker console must allow the user to “switch broker / logout” so I can create another broker from the same browser.
- `/app/loads/new` should still be accessible and able to create a new broker when there is no active session.

Tasks:

1.1. Implement a small server helper for sessions (if not already present):
- `getCurrentBroker(req)` – reads cookie, finds broker in DB, returns it or null.
- `setBrokerSession(res, brokerId)` – sets the cookie.
- `clearBrokerSession(res)` – clears the cookie.

1.2. On the New Load creation flow:
- If there is no broker in session AND request body includes `brokerEmail` and `brokerName`:
  - find or create broker by email,
  - set session for that broker,
  - proceed to create the load and stops as you already do.
- If a broker session exists, do NOT create a new broker; just use the current broker.

1.3. Add a “Switch workspace / Logout” option to the Broker console burger menu:
- When clicked:
  - Call a new endpoint (e.g. `POST /api/brokers/logout`) that:
    - calls `clearBrokerSession(res)`,
  - then redirects client to `/` (landing console selector).
- After logout, `/app/loads`, `/app/loads/new` etc. should require a broker session; if none:
  - redirect to `/` OR
  - show a minimal “No broker selected” message and a link back to `/`.

============================================================
2) LOAD DETAILS PAGE (FIX "LOAD NOT FOUND")
============================================================

Current issue:
- In the Broker console, clicking on a load in “Your Loads” navigates to a details page but shows “Load not found”.

Design:
- The details page should show:
  - load number, broker/shipper,
  - pickup & delivery info,
  - current status,
  - buttons to copy:
    - public tracking link (for shipper/receiver),
    - driver mini-app link (for the driver),
    - rate confirmation link (optional).
- This page already existed as a component; we now need to properly wire it to real DB and the correct route.

Tasks:

2.1. Decide on URL parameter:
- Use the DB `id` (UUID) as the primary identifier for the internal details page:
  - e.g. `/app/loads/:id`.
- The public tracking for shippers can still use `trackingToken` separately such as `/track/:trackingToken`.

2.2. Update the loads list:
- In the Broker console table (Your Loads), ensure each row links to `/app/loads/{load.id}` (NOT just the loadNumber).
- The anchor text can remain `load.loadNumber` (e.g. LD-2025-1305).

2.3. Implement the details page route, e.g. `app/app/loads/[id]/page.tsx`:
- Fetch load from API: `GET /api/loads/:id`.
- The API should:
  - verify that the current broker session matches `load.brokerId` (security),
  - include stops, driver, etc.:

    const load = await prisma.load.findUnique({
      where: { id },
      include: {
        broker: true,
        driver: true,
        stops: { orderBy: { sequence: "asc" } },
      },
    });

- If not found or broker mismatch: return 404 “Load not found”.

2.4. Details UI:
- Use the existing card UI for a single load (if such a component exists from the driver view).
- Show:
  - basic info (load number, broker, shipper, carrier, rate),
  - origin and destination (first and last stop),
  - list of stops with “Arrived/Departed” statuses if available.
- Add buttons for links (even if they only `console.log` for now):

  - “Copy Driver App Link” → `/driver/${load.driverToken}`
  - “Copy Public Tracking Link” → `/track/${load.trackingToken}`
  - “Copy Rate Confirmation Link” → `/rate/${load.id}` or similar.

- Use `navigator.clipboard.writeText(...)` with a toast/snackbar.

============================================================
3) SYSTEM MENU PAGES (BILLING, SETTINGS, INTEGRATIONS, SUPPORT)
============================================================

Goal:
- Make all entries in the system / burger menu clickable and render meaningful, but still simple, content.

Tasks:

3.1. Burger menu structure:
- Ensure menu includes (or update it to include):

  - Your Loads (default) – `/app/loads`
  - Billing – `/app/billing`
  - Settings – `/app/settings`
  - Integrations – `/app/integrations`
  - API & Magic Links – `/app/api-keys`
  - Support – `/app/support`

3.2. Implement the pages with simple but structured content:

- `/app/billing`:
  - Show current plan (fields from Broker model, see below).
  - Show usage summary: loads this month, included loads, extra loads.
  - 3 cards:
    - Card payment (Stripe – “coming soon”).
    - Invoice / Bank: form `companyName`, `billingEmail`, `notes` → POST `/api/billing/invoice-request`.
    - Crypto: show static wallets (from env or config) and a simple “I paid” button → POST `/api/billing/crypto-payment`.

- `/app/settings`:
  - Form bound to broker profile:
    - `brokerName`, `contactPhone`, `defaultEquipmentType`, `timezone`.
  - Save via `PATCH /api/brokers/me`.

- `/app/integrations`:
  - Non-functional toggles / checkboxes for:
    - Webhooks (show “Your webhook URL: (coming soon)”).
    - MacroPoint / Project44 / FourKites (disabled toggles, labels “planned”).
  - Store basic integration preferences in a `broker_integrations` table or a JSON column in Broker.

- `/app/api-keys`:
  - Show a generated API key for the broker (`apiKey` column on Broker).
  - Button “Regenerate” → POST `/api/brokers/regenerate-api-key`.
  - Section listing the last few magic-link logins (from `verification_tokens` table).

- `/app/support`:
  - Show email `support@pingpoint.app` (placeholder).
  - Show a textarea “Send message to support” that just logs/stores messages in a `support_tickets` table.

3.3. Update Broker model (Prisma) if needed:
- Add fields:

  - `plan` (String, e.g. "free" | "starter" | "pro")
  - `billingStatus` (String, e.g. "trial" | "active" | "past_due")
  - `includedLoads` (Int, default 0)
  - `extraPricePerLoad` (Decimal)
  - `apiKey` (String, nullable)

- Run `prisma migrate dev` after editing `schema.prisma`.

============================================================
4) BILLING LOGIC STUB (PRICING MODEL)
============================================================

Goal:
- Implement minimal pricing logic:
  - Free trial or pay-per-load,
  - Starter subscription with included loads and extra per-load price.

We do NOT integrate with real payment providers yet, just store state.

Tasks:

4.1. Add a `loadUsage` helper:
- For the current broker and current billing month:
  - count loads (`prisma.load.count`).
- Provide this info to `/app/billing` page as props.

4.2. Implement simple pricing in code comments:
- Example:

  - Free / guest: 0 plan, pay-per-load `$0.99`.
  - Starter: `$100/month` including 200 loads, `extraPricePerLoad` `$0.99`.

4.3. On every load creation (backend):
- Optionally write a `billing_events` row with:
  - brokerId, loadId, type: "created".
- No need to actually charge; just store for future billing engine.

============================================================
5) MAGIC-LINK VERIFICATION FLOW (EMAIL BANNER)
============================================================

Current behavior:
- When a broker is created from the first load, the console shows a banner:
  “We’ve sent a verification link to EMAIL. Please confirm your email…”
- But the magic link does not work (no verify route / no email being generated).

Goal:
- Create a working magic-link system:
  - When broker is created, generate a token and “send” (for now log) a verification URL.
  - When that URL is opened, mark `emailVerified = true` for the broker.
  - Banner disappears after verification.

Tasks:

5.1. Confirm Prisma models:
- Ensure there is a `VerificationToken` model with at least:

  - `id` (uuid)
  - `brokerId` (FK to Broker)
  - `token` (string, unique)
  - `expiresAt` (DateTime)
  - `used` (Boolean)

- Ensure Broker has `emailVerified` (Boolean, default false).

5.2. Token creation on broker registration:
- In the code where a new broker is created (first load creation or explicit signup):

  - Generate a secure random token (e.g. using `crypto.randomBytes(32).toString("hex")`).
  - Insert into `verification_tokens` with:
    - brokerId,
    - token,
    - expiresAt = now + 7 days,
    - used = false.

  - Build verify URL:
    - `${BASE_URL}/verify?token=${token}`
    - `BASE_URL` from env or infer from request (for Replit dev use the current host).

  - For now, “send email” by:
    - logging `console.log("MAGIC LINK (dev):", verifyUrl)`
    - Optionally, store last sent `verifyUrl` on the broker for debugging.

5.3. Implement `/verify` route (page + API):

- API endpoint `GET /api/brokers/verify?token=...`:
  - Find token by `token` and `used = false` and `expiresAt > now`.
  - If not found → return 400 (invalid or expired).
  - If found:
    - Set `broker.emailVerified = true`.
    - Set `verification_token.used = true`.
    - Optionally update broker session cookie for that broker.
  - Return a simple JSON `{ ok: true }`.

- Page `app/verify/page.tsx`:
  - Read `token` from search params.
  - Call the API endpoint.
  - If success:
    - Show “Email verified, redirecting to console…”
    - Redirect to `/app/loads`.
  - If error:
    - Show error message (“Link is invalid or expired”).

5.4. Banner behavior in Broker console:
- In Broker console data fetch, include `emailVerified`.
- Show the banner only when `!emailVerified`.
- After successful verification (and reload), the banner must not appear.

============================================================
6) QUICK SANITY CHECK
============================================================

After implementing all above:

1. From `/`:
   - Select Broker / Dispatcher.
   - Create a new load; it should:
     - create broker (if first time),
     - set session,
     - show banner about verification,
     - display the new load in the table.

2. Click load ID:
   - You should see a full load details page with copy buttons.
   - No “Load not found”.

3. Use burger menu:
   - Visit Billing (see stub pricing and methods),
   - Settings (edit broker settings),
   - Integrations (see toggles),
   - API & Magic Links (see API key, logins),
   - Support (send a test ticket).

4. Use logout/switch workspace:
   - Click “Logout / Switch broker”.
   - You should be returned to `/`.
   - Create another broker by creating a new load with a different email.

5. Magic link:
   - For dev, copy the logged `MAGIC LINK (dev)` URL from server logs.
   - Open it in the browser:
     - It should confirm email and redirect to `/app/loads`.
     - Banner should disappear for that broker.

Please implement all these tasks now, keeping changes as focused as possible and preserving the existing design and animations.